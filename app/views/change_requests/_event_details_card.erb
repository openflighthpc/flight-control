<% event = locals[:event] %>
<% parent_event = locals[:parent_event] %>
<% repeated = parent_event ? true : false %>

<div class="card event-details-card rounded-0 <%= 'border-bottom-0' if locals[:bottom_border] %>">
  <div class="event-details-text d-flex flex-row">
    <div class="event-details-column">
      <ul class="list-group list-group-flush">
        <% if repeated %>
          <li class="pb-3">
            <strong>Part of repeated event schedule: </strong><br>
            <ul class="list-group list-group-flush ml-3">
              <li>On: <%= parent_event.formatted_days %></li>
              <li>Until: <%= parent_event.parsed_end_date_time.in_time_zone(Rails.configuration.time_zone) %></li>
            </ul>
          </li>
        <% end %>

        <% event.counts.each do |group, counts| %>
          <li>
            <strong><%= group %></strong>
            <ul class="list-group list-group-flush ml-3">
              <% counts.each do |type, count| %>
                <li>
                  <strong>
                    <%= InstanceMapping.customer_facing_type(@project.platform, type) %>:
                  </strong>
                  <%= "#{count} nodes #{event.counts_criteria=='min' ? 'minimum' : 'exactly'}" %>
                </li>
              <% end %>
            </ul>
          </li>
        <% end %>
        <% unless repeated %>
          <li class="pt-3">
            <strong>Status:</strong> <%= event.status.upcase %>
          </li>
        <% end %>
      </ul>
    </div>
    <div class="event-details-column">
      <ul class="list-group list-group-flush">
        <li>
          <strong>Submitted by:</strong> <%=User.find(event.user_id).username %>
        </li>
        <li>
          <strong>Submitted at:</strong> <%= event.created_at.in_time_zone(Rails.configuration.time_zone) %>
        </li>
        <% if event.updated_at %>
          <li>
            <strong>Last edited at:</strong> <%= event.updated_at.in_time_zone(Rails.configuration.time_zone) %>
          </li>
        <% end %>
        <% if repeated %>
          <li class="pt-3">
            <strong>Status:</strong> <%= event.status.upcase %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>

  <div class="row event-details-buttons justify-content-md-end text-center">
    <% if event.editable? %>
      <button class="btn btn-sm btn-warning edit-button"
              onclick="window.location.href='/events/<%= event.actual_or_parent_id %>/edit?project=<%= event.project.name %>'">
        Edit
      </button>
      <% end %>
    <% if event.cancellable? %>
        <%= button_to "Cancel",
                      {action: "cancel", id: event.actual_or_parent_id,
                       project:  event.project.name},
                      {data: { confirm: 'Are you sure you want to cancel this request?' },
                       class: "btn btn-sm btn-danger cancel-button"} %>
      <% end %>
  </div>
</div>